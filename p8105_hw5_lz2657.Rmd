---
title: "p8105_hw5_lz2657"
author: Lingyu Zhang
date: Nov 5, 2018
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(purrr)
library(broom)
```

## Problem 1

First, set up a dataframe containing all file names.

```{r problem1_read_file_names}
  df = list.files(path = "./data/") %>%
    as.tibble()

  df
```

Next, make a reading function, read in data for each subject and save the result as the "observe" variable.

```{r problem1_read_data}
read_csv_function = function(file_name){
  subject =
    read_csv(file = str_c("./data/", file_name)) %>%
    mutate(file = file_name)
}

df = mutate(df, observe = map(.x = df[[1,]], ~ read_csv_function(.x)))
```

Now tidy the result.

```{r problem1_tidy}
df = df%>%
  separate(value, into = c("arm", "number"), sep = "_") %>%
  mutate(number = substr(number, 1, 2)) %>%
  unnest %>%
  gather(key = week, value = data, week_1:week_8) %>%
  mutate(week = substr(week, 6, 6)) %>%
  select(arm, number, week, data)

df
```

Then we can make a spaghetti plot showing observations on each subject over time.

```{r problem1_plot}
ggplot(df, aes(x = week, y = data, color = number, group = number)) + 
  geom_line() + 
  facet_grid( ~ arm) + 
    labs(
      title = "subject observations over time",
      x = "week",
      y = "observation"
    ) +
    viridis::scale_color_viridis(
      name = "ID", 
      discrete = TRUE
    )
```

The observations of the subjects in the control arm almost keep constant and even a little bit decreasing, while those of the experimental arm have an obvious trend of increasing.

## Problem 2

```{r problem2_read_tidy}
homicide_url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

homicide_data = 
  read.csv(url(homicide_url)) %>% 
  janitor::clean_names() %>% 
  as_tibble()

homicide_data
```

The raw dataset has `r nrow(homicide_data)` rows of `r ncol(homicide_data)` variables, including uid, reported date, last and first name, race, sex and age of the victims, city, state, latitude, longitude and disposition. All of the dates fall in 2017. There are four wrong data in the raw dataset with the row number of 560, 49180, 51023 and 51024. 